import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'
import router from './router'
import './assets/main.css'
import './assets/styles/common.css'

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–∏–≤—É click-outside
import { clickOutside } from './directives/clickOutside.js'

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∫–æ–Ω–∫–∏
import {
  Search,
  User,
  Menu,
  X,
  Home,
  Briefcase,
  FileText,
  MapPin,
  Phone,
  Mail,
  Bell,
  Settings,
  LogOut,
  ChevronDown,
  Building,
  Users,
  Plus,
  Edit,
  Trash2,
  Eye,
  Check,
  AlertCircle,
  ArrowRight,
  Star,
  Heart,
  Calendar,
  Clock
} from 'lucide-vue-next'

const app = createApp(App)
const pinia = createPinia()

// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∏–∫–æ–Ω–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
const icons = {
  Search,
  User,
  Menu,
  X,
  Home,
  Briefcase,
  FileText,
  MapPin,
  Phone,
  Mail,
  Bell,
  Settings,
  LogOut,
  ChevronDown,
  Building,
  Users,
  Plus,
  Edit,
  Trash2,
  Eye,
  Check,
  AlertCircle,
  ArrowRight,
  Star,
  Heart,
  Calendar,
  Clock
}

Object.entries(icons).forEach(([name, component]) => {
  app.component(`${name}Icon`, component)
})

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
app.config.errorHandler = (err, instance, info) => {
  console.error('üö® Global error:', err)
  console.error('Component:', instance)
  console.error('Error info:', info)
  
  // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  if (import.meta.env.PROD) {
    // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.')
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤
window.addEventListener('unhandledrejection', (event) => {
  console.error('üö® Unhandled promise rejection:', event.reason)
  
  if (import.meta.env.PROD) {
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–∫–∞–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    event.preventDefault()
  }
})

// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–∏–≤—É click-outside
app.directive('click-outside', clickOutside)

app.use(router)
app.use(pinia)

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è auth store
async function initializeApp() {
  try {
    const { useAuthStore } = await import('./stores/auth')
    const authStore = useAuthStore()
    authStore.init()
  } catch (error) {
    console.warn('Auth store initialization failed:', error)
  }
}

app.mount('#app')

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º auth –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
initializeApp()

// ‚ú® –ü–†–û–°–¢–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø - –ë–ï–ó –°–õ–û–ñ–ù–û–ô –õ–û–ì–ò–ö–ò
console.log('üçΩÔ∏è ShiftworkKZ App –¥–ª—è –æ–±—â–µ–ø–∏—Ç–∞ –ê—Å—Ç–∞–Ω—ã –∑–∞–ø—É—â–µ–Ω!')
console.log('üé® –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–æ–≤–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏')

// –£–±–∏—Ä–∞–µ–º —Å–ª–æ–∂–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é stores –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫
