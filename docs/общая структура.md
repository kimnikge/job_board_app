# Общая структура и статус проекта

## 1. Назначение проекта
Платформа для рынка труда общепита Астаны: публикация вакансий (обычных и срочных), профили соискателей и работодателей, управление откликами, уведомления и тестовые локальные данные для быстрого прототипирования.

## 2. Текущий технологический стек
Frontend: Vue 3 (Composition API), Vite, Pinia, Vue Router, кастомный CSS (gradients + glass), локальные JSON данные.
Backend: Supabase (PostgreSQL, Auth, Storage, Edge Functions потенциально), SQL миграции, Node.js скрипты (инициализация/заполнение БД).
Тесты: Vitest (25+ тестов), unit + integration.
Деплой: Netlify (frontend). Докер/CI пока отсутствует.

## 3. Верхнеуровневая структура репозитория
```
backend/          # Скрипты БД, миграции supabase, генерация тестовых данных
frontend/         # Исходный код клиентского приложения
 docs/            # Архитектурные и плановые документы
 netlify.toml     # Конфигурация деплоя фронтенда
 README.md        # Краткое описание
```

## 4. Frontend структура (src)
```
src/
  App.vue            # Корневой компонент
  main.js            # Точка входа (инициализация app, router, pinia)
  router/            # index.js маршруты
  stores/            # Pinia stores: auth, jobs, profile, companies, notifications
  services/          # API слой (supabase wrapper + сущности)
  components/        # UI и бизнес компоненты
    ui/              # Базовые переиспользуемые компоненты
    jobs/ company/ profile/ layout/ auth/  # Семантические группы (частично заполнено)
  views/             # Страницы (по одной на route)
  data/              # Локальные JSON (urgentJobs, userProfiles)
  composables/       # (пока пусто или минимально) потенциальная логика reuse
  utils/             # (требует наполнения: helpers, formatters)
  assets/            # Стили и изображения
  test/              # Vitest тесты
```

## 5. Основные сущности и их реализация
| Сущность | Статус | Реализация | Примечания |
|----------|--------|------------|------------|
| Пользователь (auth) | Базово | store auth.js + services/auth.service.js | Нет ролей работодателя/соискателя разграниченных на уровне RLS
| Профиль | Частично | store profile.js + fallback JSON | Нет видео, бейджей, шкал навыков
| Вакансии обычные | Есть | jobs.js + jobs.service.js | Объединены срочные/обычные логически
| Срочные вакансии | Упрощено | `urgentJobs.json` + компонент `UrgentJobCard.vue` | Нет полноценных CRUD через БД
| Компании | Базово | companies.js + companies.service.js | Нужны расширенные поля (адрес, логотип storage)
| Отклики | Частично | Через profileService.getUserApplications | Нет полноценного UI списка
| Уведомления | Есть | notifications.js + NotificationSystem.vue | Примитивная система (без Web Push)
| Навыки/скиллы | Нет | — | Требуются таблицы и визуализация
| Бейджи | Нет | — | Требуются таблицы, логика выдачи, UI
| Опыт (таймлайн) | Нет | — | Пока просто текст about/skills
| Видео профиль | Нет | — | Нужен компонент загрузки и storage bucket

## 6. Stores (Pinia) обзор
- auth.js: авторизация пользователя (минимальная логика, без refresh стратегий и ролей)
- profile.js: загрузка/обновление профиля и резюме, аватар upload; отсутствуют методы для skills/badges/experience
- jobs.js: хранение и фильтрация вакансий (нужна унификация статусов и типов)
- companies.js: хранение компаний (минимум полей)
- notifications.js: централизованные тосты (нет категорий achievement / warning отдельно)

## 7. Services API слой
- supabase.js: базовая инициализация клиента + isDemoMode
- auth.service.js: операции входа/регистрации (упрощённо)
- jobs.service.js / companies.service.js / profile.service.js: стандартные CRUD/SELECT
- notificationService.ts: вероятно устаревший артефакт (проверить актуальность)

Пробелы:
- Нет сервисов: badges, skills, experience (work logs), media/video
- Нет обработчиков ошибок единообразных (централизованный error interceptor)

## 8. Тесты
Файлы в `src/test/` покрывают:
- Авторизацию, companies, jobs (advanced), профиль, уведомления, urgent jobs.
Статус: 25+ тестов проходят (по плану). Нет тестов для: видео, бейджей, skills, timeline, рекомендаций.

## 9. Backend / Supabase
Доступны SQL миграции (исторические) в `backend/supabase/migrations`, включающие создание справочников, urgent jobs, профилей, нотификаций.
Пробелы относительно нового ТЗ профиля:
- Нет таблиц: skills, badges, employers (обособленной), work_logs, badge_skill_links
- Нет триггеров пересчёта навыков и выдачи бейджей
- Нет storage bucket для видео (только avatars предполагается)
- Нет Edge Functions для автоматизации бейджей

## 10. Документы (docs)
Содержатся планы рефакторинга, архитектурные цели, ТЗ профиля. Новый файл `общая структура.md` — свод.

## 11. Готовность модулей (оценка)
| Модуль | % готовности (к требуемому видению) | Комментарий |
|--------|-------------------------------------|-------------|
| Базовый профиль (текст) | 50% | Есть отображение данных, нет интерактивного портфолио
| Видео профиль | 0% | Отсутствует полностью
| Бейджи / достижения | 0% | Ни модели, ни UI
| Навыки прогресс | 0% | Есть только список строкой
| Таймлайн опыта | 0% | Нет структуры work_logs
| Срочные вакансии | 70% | Базовый UI + локальные данные, нет CRUD/API
| Обычные вакансии | 65% | CRUD частично (зависит от миграций), нет расширенных фильтров
| Компании | 50% | Базовые данные, не связаны с бейджами/рекомендациями
| Уведомления | 60% | Тосты работают, нет push и типов
| Авторизация | 55% | Нет ролей и восстановления сессий/refresh
| Тестовый контент (JSON) | 90% | Хватает для демонстрации MVP
| Интеграция Supabase | 60% | Базовые запросы, нет продвинутых функций/триггеров
| UI инфраструктура (базовые компоненты) | 70% | Есть Base* компоненты, нет системного дизайн-токена/Tailwind

## 12. Ключевые технические долги
1. Отсутствие модулей навыков/бейджей/видео → блокирует реализацию ТЗ профиля.
2. Разрозненная логика формата данных (локальные JSON vs Supabase) → нужен единый слой адаптеров.
3. Отсутствие централизованной обработки ошибок и статусов (loading/error pattern дублируется).
4. Нет унифицированной типизации (TypeScript частично — только env.d.ts; имеет смысл внедрить строго).
5. Нет Tailwind (указан в ТЗ), поддержание ручных стилей будет дороже.
6. Миграции требуют консолидации (много форс-ресетов — нужна финальная «чистая» схема).

## 13. Рекомендуемый план доработок (выписка)
1. Backend (schema increment): добавить таблицы employers (расширить), skills, badges, work_logs, badge_skill_links.
2. Triggers & Functions: выдача бейджа, пересчёт навыков, агрегаты опыта.
3. Video pipeline: bucket + upload + превью генерация (можно временно без генерации — только загрузка).
4. Frontend компоненты (новые): VideoProfile, BadgeCarousel, SkillBar, ExperienceTimeline.
5. Расширение profile store/service: методы fetchSkills, fetchBadges, fetchExperience, uploadVideo.
6. UI: внедрить Tailwind; постепенно мигрировать CSS.
7. Notifications: добавить тип achievement + интеграцию с выдачей бейджей.
8. Тесты: добавить набор для навыков, бейджей, видео upload (mocks). 
9. Типизация: начать перевод сервисов на TS (поэтапно). 

## 14. Риски и смягчение
| Риск | Влияние | Митигация |
|------|---------|-----------|
| Несогласованность схемы БД | Высокое | Зафиксировать ERD перед внедрением | 
| Увеличение сложности UI без дизайн-системы | Среднее | Tailwind + токены + команда UI компонентов |
| Задержка видео функционала (FFmpeg) | Среднее | Первый этап: только upload + preview tag |
| Переизбыточные миграции (reset) | Среднее | Новый «consolidated» migration baseline |

## 15. Итоговое резюме
Проект имеет прочный каркас (роутинг, stores, базовые сервисы, тесты), но профиль пока классический и не соответствует интерактивному ТЗ (видео/бейджи/скиллы). Следующие критические вехи: расширенная схема БД, модуль видео и геймификация профиля. После этого платформа перейдёт от MVP к уникальному продукту с дифференциацией.

---
Обновить раздел можно после добавления схемы ERD и первых миграций для навыков/бейджей.

# Техническое задание (обновлённое)

Данный документ описывает актуальные задачи и требования для разработки платформы рынка труда общепита Астаны. Проект включает публикацию вакансий, профили соискателей и работодателей, управление откликами, интеграцию с Telegram WebApp, мобильную адаптивность и поддержку PWA.

## 1. Цель проекта

- Создать современную платформу для поиска работы и сотрудников в сфере общепита Астаны.
- Обеспечить удобный интерфейс для соискателей и работодателей, реализовать геймификацию профиля (скиллы, бейджи, видео), интеграцию с Telegram WebApp и поддержку мобильных устройств.

## 2. Текущий стек

- **Frontend:** Vue 3 (Composition API), Vite, Pinia, Vue Router, Tailwind CSS (планируется), PWA.
- **Backend:** Supabase (PostgreSQL, Auth, Storage), SQL миграции, Node.js скрипты для инициализации/заполнения БД.
- **Тесты:** Vitest (unit и integration).
- **Деплой:** Netlify (frontend).

## 3. Обязательные задачи

### Backend
- Реализовать миграции для новых таблиц:
  - `skills` — справочник навыков и связи с пользователями.
  - `badges` — справочник достижений/бейджей.
  - `work_logs` — опыт работы (таймлайн).
  - `badge_skill_links` — связи между бейджами и навыками.
  - Обновить таблицу профиля для хранения видео и расширенных полей.
- Настроить storage bucket для загрузки видео профиля.
- Реализовать функции/триггеры:
  - Автоматическая выдача бейджей при достижении порога навыка.
  - Агрегация опыта работы.

### Frontend
- Реализовать новый профиль пользователя:
  - Компоненты: VideoProfile, BadgeCarousel, SkillBar, ExperienceTimeline.
  - Обновить store `profile` и добавить методы для загрузки/обновления skills, badges, work_logs, видео.
- Обновить stores и services:
  - Добавить stores/services для skills, badges, work_logs.
  - Реализовать централизованную обработку ошибок.
- Обновить структуру компонентов:
  - Вынести базовые UI-компоненты.
  - Провести рефакторинг для поддержки адаптивности.

### UI/UX
- Внедрить Tailwind CSS для унификации стилей.
- Обеспечить адаптивную верстку для мобильных и десктопных устройств.
- Продумать дизайн-токены и систему компонентов.
- Обеспечить доступность (a11y) основных элементов.
- Реализовать PWA: манифест, offline-режим, иконки.

### Telegram WebApp
- Интегрировать авторизацию через Telegram WebApp.
- Добавить адаптацию UI под Telegram (стили, размеры, навигация).
- Обеспечить передачу и валидацию user_id/session из Telegram.
- Провести тестирование работы внутри Telegram-клиента.

## 4. Требования к мобильной адаптивности

- Все основные страницы и компоненты должны корректно отображаться на экранах от 320px.
- Использовать мобильные breakpoint-ы Tailwind.
- Кнопки и интерактивные элементы должны быть удобны для нажатия пальцем.
- Текст и иконки — читаемы на малых экранах.
- Проверить интерфейс на устройствах Android/iOS.

## 5. Требования к PWA

- Реализовать файл манифеста (manifest.json) с необходимыми параметрами.
- Добавить иконки для разных размеров.
- Настроить offline-режим (service worker).
- Проверить корректность установки приложения на мобильные устройства.
- Тестировать работу push-уведомлений (при поддержке браузера).

## 6. Требования к интеграции с Telegram WebApp

- Использовать Telegram WebApp API для аутентификации пользователей.
- Передавать и валидировать Telegram user_id/session.
- UI должен корректно адаптироваться под Telegram WebView (цвета, размеры, отсутствие лишней навигации).
- Поддерживать работу в мобильном Telegram-клиенте и десктопе.

## 7. Тестирование

- Покрыть unit и integration тестами:
  - Авторизация, профиль, навыки, бейджи, опыт, видео, вакансии, компании, уведомления.
- Добавить тесты для новых компонентов профиля (скиллы, бейджи, видео, таймлайн).
- Провести ручное тестирование на мобильных устройствах и в Telegram WebApp.
- Проверить корректность работы PWA и offline-режима.

## 8. Этапы разработки

1. **Backend:**
   - Реализация миграций для skills, badges, work_logs, badge_skill_links.
   - Настройка storage bucket для видео.
   - Реализация функций/триггеров.
2. **Frontend:**
   - Рефакторинг структуры, внедрение Tailwind.
   - Разработка новых компонентов профиля.
   - Обновление stores/services под новые сущности.
3. **UI/UX:**
   - Адаптивная верстка, унификация компонентов.
   - Настройка PWA.
4. **Telegram WebApp:**
   - Интеграция авторизации, адаптация UI.
   - Тестирование в Telegram.
5. **Тестирование:**
   - Покрытие тестами новых функций.
   - Ручное тестирование на устройствах.
